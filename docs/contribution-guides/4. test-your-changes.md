# Contribution Guides

1. **[Get Set up](<1. get-set-up.md>)**
2. **[Build Authentication Server Sample](<2. build-authentication-sample.md>)**
3. **[Run Authentication Server Sample](<3. run-authentication-sample.md>)**
4. **[Test Your Changes](<4. test-your-changes.md>)**
5. **[Write Unit Tests](<5. write-unit-tests.md>)**
6. **[Submit a PR](<6. submit-a-pr.md>)**
7. **[Publish Your Changes](<7. publish-your-changes.md>)**



## 4. Test Your Changes

### Test locally

After making changes, you should make sure they are working as expected and not breaking the existing unit tests.

1. Test your changes locally.
 // TODO

2. Run unit tests locally.

   1. Go to the project root directory.

        ```shell
        # navigate to the repository
        cd communication-services-authentication-hero-nodejs/
        ```

   2. run the existing unit tests

        You have 2 possibilities depending on displaying test coverage or not.
        1. if you do not want to display the test coverage:
            ```shell
            # Run UTs
            npm run test
            ```

        2. if you do want to display the test coverage:
            ```shell
            # Run UTs with coverage
            npm run test:coverage
            ```

    >  Note: UTs are part of our CI pipeline, so failing UTs will result in repo build failure. Also, we defined a global test coverage threshold of **80%** for branches, lines and statements. If the global coverage for any of them is below this threshold, UTs will fail.

### Test with custom deployment

The contribution is welcomed as long as the action meets our [Contribution Guides](https://github.com/Azure-Samples/communication-services-authentication-hero-nodejs/tree/main/docs/contribution-guides), but testing your changes locally does not guarantee a successful running on Azure. Before submitting a PR to the repo, we highly recommend users to deploy their updated code by themselves and test the API manually. The steps of deployment and test are listed below:

1. Download the repo, and make your own implementations. 

2. Before building package based on your local updated code, make sure the `/dist` is remove first, and then run the npm script at root directory:

    ```bash
    npm run prod
    ```

3. Zip the `/dist` folder.

4. Log in your Azure portal, create an storage account under the target resource group, then build a new container under this storage account, upload the zipped folder to the container and copy its URL

5. Go back to the Azure home page, select the option `Deploy from a custom template` and click on `Build your own template in editor`. In this step, you can copy the ARM template file from `deploy/azuredeploy.json` and paste it on the input field, but replace the `packageURL.default` with the URL of zipped folder in your Azure storage blob. Then, follow the instructions and complete the deployment of your custom authentication sample.

6. After the deployment, please follow  **[Run Authentication Server Sample](<3. run-authentication-sample.md>)** to laungh an API call

---

- Next: **[Write Unit Tests](<5. write-unit-tests.md>)**
- Previous: **[Run Authentication Server Sample](<3. run-authentication-sample.md>)**

